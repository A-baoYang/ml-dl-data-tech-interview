# 硬核操作系统指南

> 從留言看到，翻譯問題有點大...

## 前言

Data structures + Algorithms = Programming

![](https://i.imgur.com/VRZ3Fmf.png)

OS的抽象模型
1. 文件：對 I/O 設備的抽象
2. 虛擬內存：對程序存儲器的抽象
3. 進程 (process)：對一個正在運行程序的抽象
4. 虛擬機 (VM)：對整個 OS 的抽象

學習 OS 是為了幫助解決 並發問題，重點是了解 OS 是如何工作的

> 把计算机比作一栋楼。计算机的底层相当于就是楼的根基，计算机应用相当于就是楼的外形，而操作系统就相当于是告诉你大楼的构造原理，编写高质量的软件就相当于是告诉你构建一个稳定的房子。
> 
> - 作者：cxuan
> - 链接：https://leetcode.cn/leetbook/read/awesome-os-guide/egiovc/
> - 来源：力扣（LeetCode）
> - 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

![](https://i.imgur.com/0qrqjz5.png)

## 計算機構造

現代計算機系統由一個或多個處理器、主存、打印機、鍵盤、鼠標、顯示器、網絡接口以及各種輸入/輸出設備構成。

![](https://i.imgur.com/dfJGo43.png)

術業有專攻，硬體和軟體各自為坑，因此在硬體的基礎上，計算機安裝了一層軟體，作為用戶輸入指令、和電腦交互的媒介，這種軟體就是「OS」！

他的目的是要**提供用戶程序更易用的計算機模型**

帶有圖形介面的 OS ＝ 圖形用戶介面 (GUI, Graphical User Interface)
- 常見的 GUI 有 Windows, Linux, FreeBSD, MacOS 
基於文本、指令的 ＝ Shell

## 計算機部件

![](https://i.imgur.com/pztF86f.png)

硬體
- 晶片、電路板、磁盤、鍵盤、顯示器...
軟體有兩種運行模式
1. 內核態（也稱為 管態、核心態）
   1. OS 就運行在內核態中，指的是 OS 的運行狀態
   2. OS 有硬體的訪問權，所以可執行機器可運行的任何指令
2. 用戶態
   1. Shell / GUI 位於用戶態中的最低層，使得用戶可運行其他程序（例如瀏覽網站、播放音樂等）
   2. 越靠近用戶態的應用程式越容易編寫（音樂播放器比一個OS好重寫，且OS被硬體所保護避免受到竄改）

## 硬體細節

![](https://i.imgur.com/kk5wlFc.png)

- CPU
- 內存
- I/O 設備等


## CPU

> 重看


## 多線程 multithreading 和多核芯片
- 多线程允许 CPU 保持两个不同的线程状态并且在纳秒级(nanosecond) 的时间完成切换

- 每个线程对操作系统来说都像是一个单个的 CPU
  - 比如一个有两个 CPU 的操作系统，并且每个 CPU 运行两个线程，那么这对于操作系统来说就可能是 4 个 CPU。

- GPU (graphics processing unit) 是指由成千上万个微核组成的处理器。它们擅长处理大量并行的简单计算


## 內存
kjjjjj

## 進程 (process)
进程是某一类特定活动的总和，它有程序、输入输出以及状态

每个进程都有各自的虚拟 CPU，但是实际情况是 CPU 会在各个进程之间进行来回切换。

一个 CPU 只能真正一次运行一个进程的时候，即使有 2 个核（或 CPU），每一个核也只能一次运行一个线程

由于 CPU 会在各个进程之间来回快速切换，所以每个进程在 CPU 中的运行时间是无法确定的

当同一个进程再次在 CPU 中运行时，其在 CPU 内部的运行时间往往也是不固定的

单个处理器可以被若干进程共享，它使用某种调度算法决定何时停止一个进程的工作，并转而为另外一个进程提供服务。

### 進程如何被創建

- 系统初始化（init）
- 正在运行的程序执行了创建进程的系统调用（比如 fork）
- 用户请求创建一个新进程
- 初始化一个批处理工作

### 進程中止的幾種情況

- 正常退出(自愿的): 由于完成了工作而终止
- 错误退出(自愿的): 发现严重错误
- 严重错误(非自愿的): 由进程引起的错误，通常是由于程序中的错误所导致的
- 被其他进程杀死(非自愿的): 某个进程执行系统调用告诉操作系统杀死某个进程


### 進程狀態

- 创建状态 new：进程才被创建，正在申请到相关资源
- 就绪状态 ready：进程已经分配到所需资源，等待被 CPU 执行
- 执行状态 running：进程被 CPU 执行中
- 阻塞状态 waiting：进程等待某个事件，如 I/O 请求、信号
- 终止状态 terminated：进程完成执行

